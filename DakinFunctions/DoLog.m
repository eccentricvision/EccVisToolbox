function [final,energy]=DoLog(im, scale)NoFilters=length(scale);[m n,nchannels]=size(im);[X,Y]=meshgrid(-n/2+1:n/2,-m/2+1:m/2);dist=X.^2+Y.^2;sig2=2.*scale.^2;if (nchannels>1)    final=zeros(m,n,nchannels,NoFilters);else    final=zeros(m,n,NoFilters);endfor i=1:NoFilters    %log1(:,:,i) = fft2(NormImage(-1.*fspecial('log',[m n],scale(i)),0,1));    log1(:,:,i) = fft2((1/(pi*scale(i)^4)).*(1-(dist./sig2(i))).*exp(-dist/sig2(i)));   %endfor i=1:nchannels	if (isreal(im(:,:,i)))			ffttmp(:,:,i)=fft2(double(im(:,:,i)));		else			ffttmp(:,:,i)=double(im(:,:,i));        end end for i=1:nchannels    for j=1:NoFilters		ThisRes=fftshift(real(ifft2(ffttmp(:,:,i).*log1(:,:,j))));        a=NormImage(ThisRes,0,127);        if (nchannels>1)            final(:,:,i,j)=ThisRes;             if nargout>1                energy(i,j)=std(a(:));            end                else            final(:,:,j)=ThisRes;            if nargout>1                energy(j)=sum(ThisRes(:).^2);                energy(j)=std(a(:));            end                end	end;		end